\documentclass[draftclsnofoot, onecolumn, 10pt, compsoc]{IEEEtran}

\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[top=0.75in, bottom=0.75in, left=0.75in, right=0.75in]{geometry}

\title{\textbf{Operating Systems II}\\Fall 2017\\Homework 2}

\author{Jeremy Fischer\\Omeed Habibelahian\\Group 17}

\date{\today}

\begin{document}
	\maketitle
	\newpage

	\section{Design}
		We are basing our LOOK scheduler off of the noop-iosched module found in the block directory. We will replace the add request function with one that performs an on-the-fly insertion sort where each new request will be positioned in the request queue according to its block position (the request's sector). 
		The dispatch function will service requests in one direction at a time. 
		When the next request isn't "on the way" in the direction that the arm is heading this tells the scheduler there are no more requests headed this way.
		At that point the scheduler will "turn around" and start scheduling requests in the opposite direction.
	\section{Version Control Log}
		\begin{tabular}{| p{6.8cm} | p{1.3cm} | p{2.5cm} | p{2cm} | p{4.2cm} |}
			\hline
			Commit Code Number & Merge & Author & Date & Message \\ \hline

			3f240860e80976e8e5b82f5d566d4b2b3f74a90a
			& -
			& Jeremy Fischer
			& Sun Oct 29 12:10:32 2017
			& added look\_iosched.c this is the file that will go in linux-yocto/block \\
			\hline

			d299da44095ef45e7590747aac3551dd2e948420
			& -
			& Jeremy Fischer
			& Sun Oct 29 11:28:27 2017
			& removed the Kconfig file that was place in the directory -- it's not needed. Edited the linux-yocto/block/Kconfig.iosched file to account for the LOOK scheduler. Also added the LOOK's object file to be compiled in the linux-yocto/block/Makefil \\
			\hline

			cafa958cb8b0c25f44d9c4a5c0ae5a0c02dba711
			& -
			& Omeed Habibelahian
			& Sat Oct 28 18:02:32 2017
			& Created patch file and added Kconfig.iosched file \\
			\hline

			3215e83f28b90e3e221b13b60d6ad4be54a25b34
			& -
			& Jeremy Fischer
			& Sat Oct 28 16:20:06 2017
			& added the catch for the condition where there is only one request in the queue \\
			\hline

			145a76b7b7899d386f7af74c0654fc0dda9d3b03
			& -
			& Jeremy Fischer
			& Sat Oct 28 16:13:57 2017
			& added the basic functionality of the dispatch function \\
			\hline

			a6992704765a50dedf02ee13defa020aa40f5460
			& -
			& Jeremy Fischer
			& Sat Oct 28 14:20:22 2017
			& finished add function \\
			\hline

			0d044e7ddf66b250e60144efafae9992ca5fc71b
			& -
			& Jeremy Fischer
			& Fri Oct 27 21:18:09 2017
    			& finished the 'add' function \\
			\hline

			e2ad4a9dd9929f2f768d2d85306e3957e8eca039
			& -
			& Jeremy Fischer
			& -Fri Oct 27 20:04:06 2017
			& added comments to each function outlining what is taking place \\
			\hline

			322e61ea59a49d28b2b43d2bdf5e8a3226ceeaea
			& c7ffb12 310f75b
			& Jeremy Fischer
			& Fri Oct 27 17:23:31 2017
			& added the noop to look skeleton. This C file will be coverted to a LOOK scheduler \\
			\hline

			c7ffb12c2beac940ce6c6c07707801bbc26651e0
			& -
			& Jeremy Fischer
			& Fri Oct 27 17:22:52 2017
			& added the noop to look skeleton. This C file will be coverted to a LOOK scheduler \\
			\hline
		\end{tabular}

		\begin{tabular}{| p{6.8cm} | p{1.3cm} | p{2.5cm} | p{2cm} | p{4.2cm} |}
			\hline
			Commit Code Number & Merge & Author & Date & Message \\ \hline

			310f75ba9aec87b0ff1bcd1ca1b0b0723952dbe4
			& -
			& Omeed Habibelahian
			& Fri Oct 27 00:01:48 2017
			& more work on including files \\
			\hline

			55b5e29917cfa6ee92067ec29f7c97b21d70d368
			& f698ec5 fba558b
			& Omeed Habibelahian
			& Thu Oct 26 23:30:14 2017
			& Merge branch 'master' of https://github.com /blazerzero/os2\_proj2 \\
			\hline

			f698ec52be56bfbe2f2af005af66b2aa765e5c5e
			& -
			& Omeed Habibelahian
			& Thu Oct 26 23:30:12 2017
			& Added linux/elevator.h file to sstf\_iosched.c \\
			\hline

			fba558b0e902fc9960935505a34a9c3f3701ad06
			& -
			& Jeremy Fischer
			& Thu Oct 26 19:41:04 2017
			& updated algorithm to continue in direction, instead of chosing closest location like before \\
			\hline

			42a3d2abc569bda1c4c2c6fb73ab7f5a4b154c29
			& -
			& Jeremy Fischer
			& Thu Oct 26 18:49:10 2017
			& added corrected \_\_merge\_two functionality. Jobs in the closest direction are added \\
			\hline

			fbf6f9b5785b7dbac7a5e092a32b897baeb7e01b
			& -
			& Jeremy Fischer
			& Thu Oct 26 18:36:10 2017
			& copied over my local start to look scheduling to the repo version \\
			\hline

			08e89e5794900264638f64f16b61e715d0de2282
			& -
			& Jeremy Fischer
			& Thu Oct 26 14:34:02 2017
			& updated makefile to target correct tex src on os2 server. Removed IEEEtran.cls since its on server already \\
			\hline

			dbbf8881c4a7e6938cefe0c6e6b9ecf576d59565
			& -
			& Omeed Habibelahian
			& Wed Oct 11 22:57:46 2017
			& Mini tweaks \\
			\hline

			b4784fc51ec852bab0e2c26bcd70894d8478cad5
			& -
			& Omeed Habibelahian
			& Wed Oct 11 21:17:07 2017
			& Added TeX file, .bib file, Makefile, and base C file. \\
			\hline

			8518251b8f31e5172abedd862ecfcde81e40e4b6
			& -
			& Omeed Habibelahian
			& Wed Oct 11 20:59:13 2017
			& Added IEEEtran.cls file for IEEEtran formatting for the writeup \\
			\hline
		\end{tabular}

	\section{Work Log}
		\begin{tabular}{| p{4cm} | p{3cm} | p{2cm} | p{8cm} |}
			\hline
			Feature Completed & By Who & When & Comments \\ \hline

			Added initial files (TeX file, .bib file, Makefile, IEEEtran.cls file, and initial C file) to project directory
			& Omeed Habibelahian
			& October 11
			& I added the TeX file for the writeup, bibliography file, Makefile for the TeX and C files, and an empty C
			program to our os2\_proj2 directory. I also added the IEEEtran class file for the writeup, but Jeremy would later
			remove this file becuase it's already installed on the os2 class server.\\
			\hline

			Corrected Makefile and removed IEEEtran.cls file from project directory
			& Jeremy Fischer
			& October 26
			& Updated the Makefile to target the correct TeX source on the os2 server. Also removed the IEEEtran.cls file
			from the project directory \\
			\hline

			Added merge functionality to our LOOK scheduler
			& Jeremy Fischer
			& October 26
			& Specifically added \_\_merge\_two functionality. At this point, jobs in the closest direction are added. \\
			\hline

			Created skeleton for noop-to-look C file
			& Jeremy Fischer
			& October 27
			& - \\
			\hline

			Edited Makefile in linux-yocto-3.19/block directory - added code enabling the Makefile to compile our scheduler
			& Omeed Habibelahian
			& October 29
			& - \\
			\hline

			Edited Kconfig.iosched file in linux-yocto-3.19 to account for the LOOK scheduler.
			& Jeremy Fischer
			& October 29
			& Also added the LOOK scheduler's object file to be compiled in the Makefile in the linux-yocto-3.19/block directory \\
			\hline


		\end{tabular}

	\section{Questions}
		\subsection{Main Point of the Assignment}
			The main point of this assignment was to understand how IO schedulers work in Linux. 
			This assignment familiarized us with\dots \\
			\begin{itemize}
				\item The API available to create our own scheduler
				\item The linux-yocto file structure
				\item The LOOK IO scheduler
				\item Resources available for kernel development
			\end{itemize}
		\subsection{Our Approach}
			We based our approach off of the block/noop-iosched.c NOOP scheduler.
			To transform the NOOP scheduler to the LOOK scheduler we had to change the \textit{dispatch} and \textit{add} functions.
			A lot of research was done to understand the kernel API.
			Specifically, elevator.h and blkdev.h were heavily looked into.
			The request queue remains sorted in ascending order. 
			So, when a request is added to the request queue in the \textit{add} function the queue is traversed until the block position of the new request is no longer greater than the block position of the request next in the traversal. 
			Like an on-the-fly insertion sort.
			The dispatch function takes care of loading the next request. 
			If the direction is moving in one direction and the next request's block position is in that direction then the next request is chosen.
			If not, then this means that there are no more requests that need to be serviced in this direction, so the scheduler "turns around" and starts servicing requests in the opposite direction.
		\subsection{Ensuring Correctness}
			To ensure that the scheduler's code is acting as expected, we've added \textit{printk()} statements throughout the code.
			Once the qemu environment is booted, check the output of the \textit{printk()} statements by typeing \textit{dmesg} in the command line or by viewing \textit{/var/log/messages}.
			The output produced by the \textit{printk} statements consists of where the disk\_head is currently, what the request\_que looks like (the request's block location), if the disk\_head is moving forward or backward, and where the disk\_head is moving next.
		\subsection{What We Learned}
				\begin{itemize}
					\item What the API available to create our own scheduler consists of
					\item The linux-yocto file structure (i.e. where each type of resource is located)
					\item The LOOK IO scheduler
					\item Resources available for kernel development such as elixir.free-electrons.com and the Linux Kernel Development book by Robert Love
					\item How to make a module in C
				\end{itemize}
			
		\subsection{How to Evaluate and Prove Correctness}
			\textbf{Steps to Run with Patch}
			\begin{enumerate}
				\item git clone "git://git.yoctoproject.org/linux-yocto-3.19" linux-yocto-3.19-patched
				\item Apply Patch
				\begin{enumerate}
					\item cp kernelAssn2.patch linux-yocto-3.19-patched/block
					\item cd linux-yocto-3.19-clean/block
					\item patch $<$ kernelAssn2.patch
				\end{enumerate}
				\item cd ../
				\item cp /scratch/files/config .config
				\item make menuconfig
				\item save and exit
				\item make -j4 all
				\item cd ../
				\item Use \textit{screen} command to create two split screens.
				\item In both screens, make sure to source the environment variable.
				\begin{enumerate}
					\item \textbf{SCREEN 1:}
					qemu-system-i386 -gdb tcp::5517 -S -nographic -kernel linux-yocto-3.19-patched/arch/x86/boot/bzImage -drive file=core-image-lsb-sdk-qemux86.ext4 -enable-kvm -net none -usb -localtime --no-reboot --append "root=/dev/hda rw console=ttyS0 debug"
					\item \textbf{SCREEN 2:} \$GDB
					\item \textbf{SCREEN 2:} target remote :5517
					\item \textbf{SCREEN 2:} continue
					\item \textbf{SCREEN 1:} log in as root
					\item \textbf{SCREEN 1:} cat sys/block/hda/queue/scheduler and notice the name of your module. In this case LOOK.
					\item \textbf{SCREEN 1:} echo 'LOOK' $>$ /sys/block/hda/queue/scheduler (this changes the scheduler)
					\item \textbf{SCREEN 1:} cat /sys/block/hda/queue/scheduler (this should now show [LOOK])
					\item \textbf{SCREEN 1:} type \textit{dmesg}. You should see the \textit{printk} statements, with their output (described above) proving that the LOOK scheduler is working correctly.
				\end{enumerate}
				\item  If no output from the \textit{printk} statements can be seen from the dmesg command, when reboot is entered you will see output.
				\item Reboot to stop qemu.
			\end{enumerate}


\end{document}
